FROM node:20-slim

RUN groupadd -g 1000 appuser 2>/dev/null || true && \
    useradd -m -u 1000 -g appuser appuser 2>/dev/null || true

WORKDIR /app/shared
COPY --chown=1000:1000 shared/package*.json ./
RUN npm install
COPY --chown=1000:1000 shared/ ./

WORKDIR /app/frontend
COPY --chown=1000:1000 frontend/package*.json ./
RUN npm install
COPY --chown=1000:1000 frontend/ .

EXPOSE 5173
USER 1000

CMD ["npm", "run", "dev"]
